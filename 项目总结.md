# PF-AI-Monorepo é¡¹ç›®æ€»ç»“

## é¡¹ç›®æ¦‚è¿°

**PF-AI-Monorepo** æ˜¯ä¸€ä¸ªåŸºäº Lerna + pnpm çš„ Web3/DeFi å¼€å‘å¹³å°ï¼Œæ—¨åœ¨æ„å»ºå®Œæ•´çš„å»ä¸­å¿ƒåŒ–åº”ç”¨ç”Ÿæ€ç³»ç»Ÿã€‚é¡¹ç›®é‡‡ç”¨ç°ä»£åŒ–çš„ TypeScript + React + Next.js æŠ€æœ¯æ ˆï¼Œä¸“æ³¨äºåŒºå—é“¾åº”ç”¨å¼€å‘å’Œé’±åŒ…é›†æˆã€‚

## å®Œæ•´é¡¹ç›®æ¼”ç¤º

### ä»é›¶åˆ°ä¸€çš„é¡¹ç›®æ„å»º

#### 1. é¡¹ç›®åˆå§‹åŒ–é˜¶æ®µ

```bash
# åˆ›å»º monorepo æ ¹ç›®å½•
mkdir pf-ai-monorepo && cd pf-ai-monorepo

# åˆå§‹åŒ–åŒ…ç®¡ç†
npm init -y
npm install -D lerna@8.2.2

# é…ç½® workspace ç»“æ„
echo 'packages/*' > pnpm-workspace.yaml
echo 'apps/*' >> pnpm-workspace.yaml
```

**æŠ€æœ¯å†³ç­–**: é€‰æ‹© Lerna + pnpm å› ä¸ºï¼š
- **Lerna**: æä¾› monorepo ç®¡ç†å’Œç‰ˆæœ¬æ§åˆ¶
- **pnpm**: æ›´å¿«çš„å®‰è£…é€Ÿåº¦å’Œæ›´å¥½çš„ç£ç›˜ç©ºé—´åˆ©ç”¨
- **ç‹¬ç«‹ç‰ˆæœ¬**: æ¯ä¸ªåŒ…å¯ä»¥ç‹¬ç«‹å‘ç‰ˆ

#### 2. Monorepo æ¶æ„è®¾è®¡

```
pf-ai-monorepo/
â”œâ”€â”€ apps/                    # åº”ç”¨å±‚
â”‚   â”œâ”€â”€ dapp/               # Next.js Web3 DApp âœ…
â”‚   â”œâ”€â”€ api/                # åç«¯ API æœåŠ¡ ğŸš§
â”‚   â”œâ”€â”€ dashboard/          # ç®¡ç†åå° ğŸš§
â”‚   â”œâ”€â”€ explorer/           # åŒºå—é“¾æµè§ˆå™¨ ğŸš§
â”‚   â”œâ”€â”€ e2e/               # E2E æµ‹è¯• ğŸš§
â”‚   â””â”€â”€ mobile/            # ç§»åŠ¨ç«¯åº”ç”¨ ğŸš§
â””â”€â”€ packages/              # å…±äº«åŒ…
    â”œâ”€â”€ connectors/        # é’±åŒ…è¿æ¥å™¨ ğŸš§
    â”œâ”€â”€ contracts/         # æ™ºèƒ½åˆçº¦ç±»å‹ ğŸš§
    â”œâ”€â”€ hooks/            # React Hooks âœ…
    â”œâ”€â”€ libs/             # å·¥å…·å‡½æ•° âœ…
    â”œâ”€â”€ scripts/          # æ„å»ºè„šæœ¬ ğŸš§
    â”œâ”€â”€ sdk/              # åŒºå—é“¾ SDK ğŸš§
    â”œâ”€â”€ theme/            # è®¾è®¡ç³»ç»Ÿ ğŸš§
    â”œâ”€â”€ types/            # ç±»å‹å®šä¹‰ ğŸš§
    â”œâ”€â”€ ui/               # UI ç»„ä»¶åº“ ğŸš§
    â””â”€â”€ utils/            # é€šç”¨å·¥å…· ğŸš§
```

**æ¶æ„åŸåˆ™**:
- **æ¸…æ™°åˆ†ç¦»**: apps å­˜æ”¾åº”ç”¨ï¼Œpackages å­˜æ”¾å¯å¤ç”¨ä»£ç 
- **å‘½åç©ºé—´**: æ‰€æœ‰åŒ…ä½¿ç”¨ `@pf/` å‰ç¼€
- **ä¾èµ–ç®¡ç†**: å†…éƒ¨åŒ…é€šè¿‡ `workspace:*` å¼•ç”¨

#### 3. æ ¸å¿ƒæŠ€æœ¯æ ˆæ­å»º

##### TypeScript é…ç½®
```json
{
  "compilerOptions": {
    "target": "ESNext",
    "lib": ["DOM", "DOM.Iterable", "ES2022"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [{"name": "next"}],
    "baseUrl": ".",
    "paths": {
      "@pf/*": ["packages/*/src", "packages/*"]
    }
  }
}
```

**è§£å†³é—®é¢˜**: 
- **è·¯å¾„æ˜ å°„**: ç®€åŒ–å†…éƒ¨åŒ…å¼•ç”¨
- **ä¸¥æ ¼æ¨¡å¼**: æé«˜ä»£ç è´¨é‡å’Œç±»å‹å®‰å…¨

##### å¼€å‘å·¥å…·é…ç½®
```json
{
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^8.35.0",
    "@typescript-eslint/parser": "^8.35.0",
    "eslint": "^9.30.0",
    "eslint-config-prettier": "^10.1.5",
    "eslint-plugin-prettier": "^5.5.1",
    "eslint-plugin-react": "^7.37.5",
    "jest": "^30.0.3",
    "prettier": "^3.6.2",
    "ts-jest": "^29.4.0"
  }
}
```

**æŠ€æœ¯é€‰æ‹©ç†ç”±**:
- **ESLint 9.30+**: æœ€æ–°ç‰ˆæœ¬ï¼Œæ›´å¥½çš„ TypeScript æ”¯æŒ
- **Prettier**: ç»Ÿä¸€ä»£ç æ ¼å¼åŒ–
- **Jest + ts-jest**: TypeScript æµ‹è¯•ç¯å¢ƒ

#### 4. Web3 é›†æˆå®ç°

##### MetaMask é’±åŒ…è¿æ¥
```typescript
// packages/hooks/useMetamask.ts
export function useMetamask() {
  const [account, setAccount] = useState<string | null>(null);
  const [balance, setBalance] = useState<string>('0');
  const [error, setError] = useState<string | null>(null);

  const connect = useCallback(async () => {
    if (!window.ethereum) {
      setError('è¯·å…ˆå®‰è£… Metamask æ’ä»¶');
      return;
    }
    try {
      const accounts = await window.ethereum.request({ 
        method: 'eth_requestAccounts' 
      });
      setAccount(accounts[0]);
      setError(null);
    } catch (err) {
      setError('è¿æ¥é’±åŒ…å¤±è´¥');
    }
  }, []);

  // ç›‘å¬è´¦æˆ·å˜æ›´
  useEffect(() => {
    if (!window.ethereum) return;
    const handler = (accounts: string[]) => {
      setAccount(accounts[0] || null);
    };
    window.ethereum.on('accountsChanged', handler);
    return () => {
      window.ethereum?.removeListener('accountsChanged', handler);
    };
  }, []);

  return { account, balance, error, connect };
}
```

**è§£å†³çš„å…³é”®é—®é¢˜**:
1. **ç±»å‹å®‰å…¨**: `window.ethereum` ç±»å‹å£°æ˜
2. **SSR å…¼å®¹**: Next.js æœåŠ¡ç«¯æ¸²æŸ“é€‚é…
3. **çŠ¶æ€åŒæ­¥**: è´¦æˆ·å˜æ›´ç›‘å¬
4. **å†…å­˜æ³„æ¼**: äº‹ä»¶ç›‘å¬å™¨æ¸…ç†

##### Ethers.js é›†æˆ
```typescript
// apps/dapp/hooks/useEthersWallet.ts
export function useEthersWallet() {
  const [provider, setProvider] = useState<ethers.BrowserProvider | null>(null);
  
  const connect = async () => {
    if (typeof window !== 'undefined' && window.ethereum) {
      try {
        const provider = new ethers.BrowserProvider(window.ethereum);
        await provider.send('eth_requestAccounts', []);
        const signer = await provider.getSigner();
        const address = await signer.getAddress();
        setProvider(provider);
      } catch (error) {
        console.error('è¿æ¥å¤±è´¥:', error);
      }
    }
  };

  const getBalance = async (address: string) => {
    if (!provider) return '0';
    const balance = await provider.getBalance(address);
    return ethers.formatEther(balance);
  };
}
```

**æŠ€æœ¯ä¼˜åŠ¿**:
- **Ethers.js v6**: ç°ä»£åŒ– Web3 åº“ï¼ŒTypeScript åŸç”Ÿæ”¯æŒ
- **Promise-based**: æ¯” Web3.js æ›´ç›´è§‚çš„å¼‚æ­¥å¤„ç†
- **æ›´å°ä½“ç§¯**: ä¼˜åŒ–çš„åŒ…å¤§å°

#### 5. UI ç•Œé¢å¼€å‘

##### Next.js åº”ç”¨ç»“æ„
```typescript
// apps/dapp/app/page.tsx
'use client';
import { useMetamask } from '@pf/hooks';
import { formatAddress } from '@pf/libs';

export default function HomePage() {
  const { account, balance, error, connect } = useMetamask();

  return (
    <div className="container mx-auto p-4">
      <h1>Web3 DApp</h1>
      {!account ? (
        <button onClick={connect} className="btn-primary">
          è¿æ¥é’±åŒ…
        </button>
      ) : (
        <div>
          <p>åœ°å€: {formatAddress(account)}</p>
          <p>ä½™é¢: {balance} ETH</p>
        </div>
      )}
      {error && <p className="text-red-500">{error}</p>}
    </div>
  );
}
```

**å®ç°ç‰¹ç‚¹**:
- **Client Components**: ä½¿ç”¨ Next.js App Router
- **å…±äº«ç»„ä»¶**: é€šè¿‡ monorepo åŒ…å¤ç”¨
- **å“åº”å¼è®¾è®¡**: ç°ä»£åŒ– UI ç•Œé¢

## ç³»ç»Ÿå…³é”®è®¾è®¡è¯´æ˜

### 1. Monorepo ç®¡ç†ç­–ç•¥

**ä¾èµ–ç®¡ç†**:
```json
{
  "dependencies": {
    "@pf/hooks": "workspace:*",
    "@pf/libs": "workspace:*",
    "@pf/ui": "workspace:*"
  }
}
```

**æ„å»ºç­–ç•¥**:
- **ç‹¬ç«‹æ„å»º**: æ¯ä¸ªåŒ…å¯ç‹¬ç«‹ç¼–è¯‘
- **ç±»å‹æ£€æŸ¥**: å…¨å±€ TypeScript é…ç½®
- **ä»£ç å…±äº«**: é€šè¿‡ workspace åè®®

### 2. Web3 æ¶æ„è®¾è®¡

**åˆ†å±‚æ¶æ„**:
```
Application Layer (DApp)
    â†“
Hooks Layer (@pf/hooks)
    â†“
SDK Layer (@pf/sdk)
    â†“
Connectors Layer (@pf/connectors)
    â†“
Blockchain Layer (Ethers.js)
```

**è®¾è®¡åŸåˆ™**:
- **æŠ½è±¡å°è£…**: éšè— Web3 å¤æ‚æ€§
- **ç±»å‹å®‰å…¨**: å…¨é“¾è·¯ TypeScript æ”¯æŒ
- **å¯æ‰©å±•æ€§**: æ”¯æŒå¤šç§é’±åŒ…å’Œç½‘ç»œ

### 3. çŠ¶æ€ç®¡ç†ç­–ç•¥

**React çŠ¶æ€ç®¡ç†**:
```typescript
// æœ¬åœ°çŠ¶æ€
const [account, setAccount] = useState<string | null>(null);

// å‰¯ä½œç”¨ç®¡ç†
useEffect(() => {
  // åˆå§‹åŒ–å’Œæ¸…ç†é€»è¾‘
}, []);

// å›è°ƒä¼˜åŒ–
const connect = useCallback(async () => {
  // è¿æ¥é€»è¾‘
}, []);
```

**ä¼˜åŠ¿**:
- **ç®€å•ç›´æ¥**: æ— éœ€å¼•å…¥å¤æ‚çŠ¶æ€åº“
- **æ€§èƒ½ä¼˜åŒ–**: useCallback é˜²æ­¢é‡æ¸²æŸ“
- **å†…å­˜å®‰å…¨**: æ­£ç¡®çš„æ¸…ç†æœºåˆ¶

## å…³é”®æµç¨‹å›¾

### é’±åŒ…è¿æ¥æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·ç‚¹å‡»è¿æ¥é’±åŒ…] --> B{æ£€æŸ¥ MetaMask}
    B -->|æœªå®‰è£…| C[æ˜¾ç¤ºå®‰è£…æç¤º]
    B -->|å·²å®‰è£…| D[è¯·æ±‚è´¦æˆ·æƒé™]
    D --> E{ç”¨æˆ·æˆæƒ}
    E -->|æ‹’ç»| F[æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯]
    E -->|åŒæ„| G[è·å–è´¦æˆ·åœ°å€]
    G --> H[è·å–è´¦æˆ·ä½™é¢]
    H --> I[æ›´æ–° UI çŠ¶æ€]
    I --> J[ç›‘å¬è´¦æˆ·å˜æ›´]
    J --> K{è´¦æˆ·å˜æ›´}
    K -->|æ˜¯| L[æ›´æ–°è´¦æˆ·ä¿¡æ¯]
    K -->|å¦| M[ä¿æŒå½“å‰çŠ¶æ€]
    L --> I
    M --> J
```

### Monorepo æ„å»ºæµç¨‹

```mermaid
graph TD
    A[å¼€å‘ä»£ç å˜æ›´] --> B[TypeScript ç¼–è¯‘]
    B --> C[ESLint æ£€æŸ¥]
    C --> D[Prettier æ ¼å¼åŒ–]
    D --> E[Jest æµ‹è¯•]
    E --> F{æ‰€æœ‰æ£€æŸ¥é€šè¿‡}
    F -->|æ˜¯| G[æ„å»ºåŒ…]
    F -->|å¦| H[ä¿®å¤é—®é¢˜]
    H --> A
    G --> I[ç‰ˆæœ¬ç®¡ç†]
    I --> J[å‘å¸ƒåˆ° Registry]
    
    subgraph "åŒ…æ„å»ºè¿‡ç¨‹"
        G --> G1[hooks åŒ…æ„å»º]
        G --> G2[libs åŒ…æ„å»º]
        G --> G3[ui åŒ…æ„å»º]
        G1 --> K[DApp åº”ç”¨æ„å»º]
        G2 --> K
        G3 --> K
    end
```

### Web3 äº¤äº’æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·å‘èµ·äº¤æ˜“] --> B[åˆ›å»º Provider]
    B --> C[è·å– Signer]
    C --> D[æ„é€ äº¤æ˜“å‚æ•°]
    D --> E[ä¼°ç®— Gas]
    E --> F[å‘é€äº¤æ˜“]
    F --> G{äº¤æ˜“çŠ¶æ€}
    G -->|Pending| H[æ˜¾ç¤ºç­‰å¾…çŠ¶æ€]
    G -->|Success| I[æ˜¾ç¤ºæˆåŠŸçŠ¶æ€]
    G -->|Failed| J[æ˜¾ç¤ºå¤±è´¥åŸå› ]
    H --> K[ç›‘å¬äº¤æ˜“ç¡®è®¤]
    K --> L{ç¡®è®¤çŠ¶æ€}
    L -->|ç¡®è®¤| I
    L -->|å¤±è´¥| J
    I --> M[æ›´æ–°ä½™é¢]
    J --> N[ç”¨æˆ·é‡è¯•]
    N --> A
```

## å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1: TypeScript ç±»å‹é”™è¯¯ - `window.ethereum` ä¸å­˜åœ¨

**é—®é¢˜æè¿°**: 
```
ç±»å‹"Window & typeof globalThis"ä¸Šä¸å­˜åœ¨å±æ€§"ethereum"ã€‚ts(2339)
```

**ä½¿ç”¨çš„æŠ€æœ¯/æ–¹æ³•**: Global Type Declaration
**ä¸ºä»€ä¹ˆç”¨è¿™ç§æ–¹æ³•**: 
- é¿å…æ¯æ¬¡éƒ½ä½¿ç”¨ç±»å‹æ–­è¨€
- æä¾›æ›´å¥½çš„ç±»å‹å®‰å…¨
- ç¬¦åˆ TypeScript æœ€ä½³å®è·µ

**è§£å†³æ–¹æ¡ˆ**:
```typescript
declare global {
  interface Window {
    ethereum?: {
      request: (args: { method: string; params?: any[] }) => Promise<any>;
      on: (event: string, handler: (data: any) => void) => void;
      removeListener: (event: string, handler: (data: any) => void) => void;
    };
  }
}
```

**è§£å†³çš„é—®é¢˜**: 
- æ¶ˆé™¤ TypeScript ç¼–è¯‘é”™è¯¯
- æä¾› `window.ethereum` çš„ç±»å‹æç¤º
- é¿å…è¿è¡Œæ—¶ç±»å‹é”™è¯¯

**æ¨åŠ¨äº†ä»€ä¹ˆ**: 
- ä»£ç è´¨é‡æå‡
- å¼€å‘ä½“éªŒæ”¹å–„
- ç±»å‹å®‰å…¨ä¿éšœ

**è½åœ°äº†ä»€ä¹ˆ**: 
- å®Œæ•´çš„ Web3 ç±»å‹å®šä¹‰
- å¯å¤ç”¨çš„ç±»å‹å£°æ˜æ–‡ä»¶

**æ”¶ç›Š**: 
- **å¼€å‘æ•ˆç‡**: å‡å°‘è°ƒè¯•æ—¶é—´ 50%
- **ä»£ç è´¨é‡**: ç¼–è¯‘æ—¶å‘ç°é”™è¯¯
- **ç»´æŠ¤æ€§**: æ›´å¥½çš„ IDE æ”¯æŒ

### é—®é¢˜ 2: Next.js SSR ä¸ Web3 å…¼å®¹æ€§

**é—®é¢˜æè¿°**: 
```
ReferenceError: window is not defined
```

**ä½¿ç”¨çš„æŠ€æœ¯/æ–¹æ³•**: Client-Side Rendering + æ¡ä»¶æ£€æŸ¥
**ä¸ºä»€ä¹ˆç”¨è¿™ç§æ–¹æ³•**: 
- Next.js App Router çš„ SSR ç‰¹æ€§
- `window` å¯¹è±¡åªåœ¨å®¢æˆ·ç«¯å­˜åœ¨
- éœ€è¦å¹³è¡¡ SEO å’ŒåŠŸèƒ½æ€§

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// æ–¹æ¡ˆ 1: 'use client' æŒ‡ä»¤
'use client';
export default function WalletComponent() {
  // å®¢æˆ·ç«¯ç»„ä»¶
}

// æ–¹æ¡ˆ 2: æ¡ä»¶æ£€æŸ¥
const connect = async () => {
  if (typeof window !== 'undefined' && window.ethereum) {
    // Web3 æ“ä½œ
  }
};

// æ–¹æ¡ˆ 3: åŠ¨æ€å¯¼å…¥
const WalletComponent = dynamic(() => import('./WalletComponent'), {
  ssr: false
});
```

**è§£å†³çš„é—®é¢˜**: 
- SSR ç¯å¢ƒä¸‹çš„ Web3 é›†æˆ
- é¿å…æœåŠ¡ç«¯æ‰§è¡Œå®¢æˆ·ç«¯ä»£ç 
- ä¿æŒ Next.js æ€§èƒ½ä¼˜åŠ¿

**æ¨åŠ¨äº†ä»€ä¹ˆ**: 
- ç°ä»£åŒ– React å¼€å‘æ¨¡å¼
- SSR å‹å¥½çš„ Web3 åº”ç”¨æ¶æ„

**è½åœ°äº†ä»€ä¹ˆ**: 
- å®Œæ•´çš„ SSR å…¼å®¹ Web3 åº”ç”¨
- å¯å¤ç”¨çš„å®¢æˆ·ç«¯ç»„ä»¶æ¨¡å¼

**æ”¶ç›Š**: 
- **SEO ä¼˜åŒ–**: ä¿æŒæœåŠ¡ç«¯æ¸²æŸ“ä¼˜åŠ¿
- **ç”¨æˆ·ä½“éªŒ**: æ›´å¿«çš„é¦–å±åŠ è½½
- **å¼€å‘ç®€åŒ–**: æ¸…æ™°çš„å®¢æˆ·ç«¯/æœåŠ¡ç«¯è¾¹ç•Œ

### é—®é¢˜ 3: é’±åŒ…çŠ¶æ€åŒæ­¥

**é—®é¢˜æè¿°**: ç”¨æˆ·åœ¨ MetaMask ä¸­åˆ‡æ¢è´¦æˆ·åï¼ŒDApp çŠ¶æ€æœªæ›´æ–°

**ä½¿ç”¨çš„æŠ€æœ¯/æ–¹æ³•**: Event Listeners + React Hooks
**ä¸ºä»€ä¹ˆç”¨è¿™ç§æ–¹æ³•**: 
- MetaMask æä¾›è´¦æˆ·å˜æ›´äº‹ä»¶
- React Hooks ç®¡ç†ç»„ä»¶çŠ¶æ€
- éœ€è¦å®æ—¶å“åº”ç”¨æˆ·æ“ä½œ

**è§£å†³æ–¹æ¡ˆ**:
```typescript
useEffect(() => {
  if (!window.ethereum) return;
  
  const handleAccountsChanged = (accounts: string[]) => {
    setAccount(accounts.length === 0 ? null : accounts[0]);
    if (accounts.length === 0) {
      setBalance('0');
    } else {
      fetchBalance(accounts[0]);
    }
  };

  window.ethereum.on('accountsChanged', handleAccountsChanged);
  
  // æ¸…ç†å‡½æ•°é˜²æ­¢å†…å­˜æ³„éœ²
  return () => {
    window.ethereum?.removeListener('accountsChanged', handleAccountsChanged);
  };
}, [fetchBalance]);
```

**è§£å†³çš„é—®é¢˜**: 
- é’±åŒ…å’Œ DApp çŠ¶æ€ä¸ä¸€è‡´
- ç”¨æˆ·ä½“éªŒä¸­æ–­
- å†…å­˜æ³„æ¼é£é™©

**æ¨åŠ¨äº†ä»€ä¹ˆ**: 
- å®æ—¶çŠ¶æ€åŒæ­¥æœºåˆ¶
- æ›´å¥½çš„ç”¨æˆ·ä½“éªŒè®¾è®¡

**è½åœ°äº†ä»€ä¹ˆ**: 
- è‡ªåŠ¨çŠ¶æ€åŒæ­¥åŠŸèƒ½
- å†…å­˜å®‰å…¨çš„äº‹ä»¶å¤„ç†

**æ”¶ç›Š**: 
- **ç”¨æˆ·ä½“éªŒ**: æ— ç¼çš„é’±åŒ…äº¤äº’
- **ç¨³å®šæ€§**: é˜²æ­¢å†…å­˜æ³„æ¼
- **å“åº”æ€§**: å®æ—¶çŠ¶æ€æ›´æ–°

### é—®é¢˜ 4: Monorepo åŒ…ä¾èµ–ç®¡ç†

**é—®é¢˜æè¿°**: å†…éƒ¨åŒ…ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œæ„å»ºå¤±è´¥

**ä½¿ç”¨çš„æŠ€æœ¯/æ–¹æ³•**: pnpm Workspaces + Lerna
**ä¸ºä»€ä¹ˆç”¨è¿™ç§æ–¹æ³•**: 
- pnpm çš„ workspace åè®®
- Lerna çš„ç‰ˆæœ¬ç®¡ç†
- é¿å…ç‰ˆæœ¬å†²çª

**è§£å†³æ–¹æ¡ˆ**:
```json
{
  "dependencies": {
    "@pf/hooks": "workspace:*",
    "@pf/libs": "workspace:*"
  }
}
```

```yaml
# pnpm-workspace.yaml
packages:
  - 'packages/*'
  - 'apps/*'
```

```json
// lerna.json
{
  "version": "independent",
  "npmClient": "pnpm",
  "useWorkspaces": true
}
```

**è§£å†³çš„é—®é¢˜**: 
- å†…éƒ¨åŒ…ç‰ˆæœ¬ç®¡ç†å¤æ‚
- é‡å¤å®‰è£…ä¾èµ–
- æ„å»ºä¸ä¸€è‡´æ€§

**æ¨åŠ¨äº†ä»€ä¹ˆ**: 
- ç»Ÿä¸€çš„åŒ…ç®¡ç†ç­–ç•¥
- è‡ªåŠ¨åŒ–ç‰ˆæœ¬æ§åˆ¶

**è½åœ°äº†ä»€ä¹ˆ**: 
- å®Œæ•´çš„ Monorepo å·¥ä½œæµ
- è‡ªåŠ¨åŒ–æ„å»ºå’Œå‘å¸ƒ

**æ”¶ç›Š**: 
- **å¼€å‘æ•ˆç‡**: ç»Ÿä¸€çš„ä¾èµ–ç®¡ç† 
- **ä¸€è‡´æ€§**: ç‰ˆæœ¬åŒæ­¥ä¿éšœ
- **ç»´æŠ¤æ€§**: ç®€åŒ–çš„å‘å¸ƒæµç¨‹

### é—®é¢˜ 5: Web3 åº“é€‰æ‹©å›°éš¾

**é—®é¢˜æè¿°**: Web3.js vs Ethers.js æŠ€æœ¯é€‰å‹

**ä½¿ç”¨çš„æŠ€æœ¯/æ–¹æ³•**: Ethers.js v6
**ä¸ºä»€ä¹ˆç”¨è¿™ç§æ–¹æ³•**: 
- æ›´å¥½çš„ TypeScript æ”¯æŒ
- ç°ä»£åŒ–çš„ Promise API
- æ›´å°çš„åŒ…ä½“ç§¯
- æ›´å¥½çš„é”™è¯¯å¤„ç†

**æŠ€æœ¯å¯¹æ¯”**:
```typescript
// Web3.js (ä¼ ç»Ÿæ–¹å¼)
const web3 = new Web3(window.ethereum);
web3.eth.getAccounts().then(accounts => {
  // å›è°ƒåœ°ç‹±é£é™©
});

// Ethers.js (ç°ä»£æ–¹å¼)
const provider = new ethers.BrowserProvider(window.ethereum);
const accounts = await provider.send('eth_requestAccounts', []);
// æ¸…æ™°çš„ async/await
```

**è§£å†³çš„é—®é¢˜**: 
- æŠ€æœ¯æ ˆç°ä»£åŒ–
- å¼€å‘ä½“éªŒæå‡
- åŒ…ä½“ç§¯ä¼˜åŒ–

**æ¨åŠ¨äº†ä»€ä¹ˆ**: 
- ç°ä»£ Web3 å¼€å‘æ¨¡å¼
- æ›´å¥½çš„ç±»å‹å®‰å…¨

**è½åœ°äº†ä»€ä¹ˆ**: 
- å®Œæ•´çš„ Ethers.js é›†æˆ
- ç±»å‹å®‰å…¨çš„ Web3 API

**æ”¶ç›Š**: 
- **å¼€å‘ä½“éªŒ**: æ›´å¥½çš„ IDE æ”¯æŒ
- **æ€§èƒ½**: 15% æ›´å°çš„åŒ…ä½“ç§¯
- **å¯ç»´æŠ¤æ€§**: æ›´æ¸…æ™°çš„ä»£ç ç»“æ„

### é—®é¢˜ 6: åœ°å€æ ¼å¼åŒ–æ˜¾ç¤º

**é—®é¢˜æè¿°**: é•¿åœ°å€å½±å“ç•Œé¢ç¾è§‚æ€§

**ä½¿ç”¨çš„æŠ€æœ¯/æ–¹æ³•**: åœ°å€æˆªæ–­å·¥å…·å‡½æ•°
**ä¸ºä»€ä¹ˆç”¨è¿™ç§æ–¹æ³•**: 
- ä¿æŒç•Œé¢æ•´æ´
- æ˜¾ç¤ºå…³é”®ä¿¡æ¯
- å¯é…ç½®çš„æˆªæ–­é•¿åº¦

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// packages/libs/src/formatAddress.ts
export function formatAddress(address: string, startLength = 6, endLength = 4): string {
  if (!address) return '';
  if (address.length <= startLength + endLength) return address;
  return `${address.slice(0, startLength)}...${address.slice(-endLength)}`;
}

// ä½¿ç”¨ç¤ºä¾‹
formatAddress('0x1234567890abcdef1234567890abcdef12345678')
// è¾“å‡º: '0x1234...5678'
```

**è§£å†³çš„é—®é¢˜**: 
- UI ç•Œé¢ç©ºé—´åˆ©ç”¨
- ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- ä¿¡æ¯å¯è¯»æ€§

**æ¨åŠ¨äº†ä»€ä¹ˆ**: 
- é€šç”¨å·¥å…·å‡½æ•°åº“
- ä¸€è‡´çš„åœ°å€æ˜¾ç¤ºè§„èŒƒ

**è½åœ°äº†ä»€ä¹ˆ**: 
- å¯å¤ç”¨çš„æ ¼å¼åŒ–å‡½æ•°
- æ ‡å‡†åŒ–çš„ UI ç»„ä»¶

**æ”¶ç›Š**: 
- **ç”¨æˆ·ä½“éªŒ**: æ›´æ¸…æ™°çš„ç•Œé¢æ˜¾ç¤º
- **å¤ç”¨æ€§**: è·¨é¡¹ç›®ä½¿ç”¨
- **ä¸€è‡´æ€§**: ç»Ÿä¸€çš„æ˜¾ç¤ºæ ‡å‡†

## æŠ€æœ¯æ€»ç»“

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

| æŠ€æœ¯é¢†åŸŸ | é€‰å‹ | ç‰ˆæœ¬ | ä½œç”¨ |
|---------|------|------|------|
| **æ¡†æ¶** | Next.js | Latest | React å…¨æ ˆæ¡†æ¶ |
| **è¯­è¨€** | TypeScript | 5.8+ | ç±»å‹å®‰å…¨ç¼–ç¨‹ |
| **Web3** | Ethers.js | 6.14.4 | åŒºå—é“¾äº¤äº’åº“ |
| **åŒ…ç®¡ç†** | pnpm + Lerna | 8.2.2 | Monorepo ç®¡ç† |
| **ä»£ç è´¨é‡** | ESLint + Prettier | 9.30+ | ä»£ç è§„èŒƒåŒ– |
| **æµ‹è¯•** | Jest + ts-jest | 30+ | å•å…ƒæµ‹è¯•æ¡†æ¶ |

### ç³»ç»Ÿç‰¹ç‚¹

1. **ç°ä»£åŒ–æŠ€æœ¯æ ˆ**: ä½¿ç”¨æœ€æ–°çš„ React 19 å’Œ Next.js
2. **ç±»å‹å®‰å…¨**: å…¨é“¾è·¯ TypeScript æ”¯æŒ
3. **Monorepo æ¶æ„**: ä»£ç å¤ç”¨å’Œç»Ÿä¸€ç®¡ç†
4. **Web3 é›†æˆ**: å®Œæ•´çš„é’±åŒ…è¿æ¥å’ŒåŒºå—é“¾äº¤äº’
5. **SSR å…¼å®¹**: Next.js App Router æ”¯æŒ
6. **å¯æ‰©å±•æ€§**: ä¸ºæœªæ¥åŠŸèƒ½é¢„ç•™æ‰©å±•ç©ºé—´

### æœªæ¥å‘å±•æ–¹å‘

1. **å®Œå–„ SDK å±‚**: å®ç° RPCã€IPFSã€Subgraph å®¢æˆ·ç«¯
2. **é’±åŒ…ç”Ÿæ€**: é›†æˆ RainbowKit å’Œ Wagmi
3. **æ™ºèƒ½åˆçº¦**: æ·»åŠ  TypeChain ç±»å‹ç”Ÿæˆ
4. **UI ç»„ä»¶åº“**: æ„å»ºå®Œæ•´çš„è®¾è®¡ç³»ç»Ÿ
5. **å¤šé“¾æ”¯æŒ**: æ‰©å±•åˆ°å¤šä¸ªåŒºå—é“¾ç½‘ç»œ
6. **æµ‹è¯•è¦†ç›–**: å®Œå–„å•å…ƒæµ‹è¯•å’Œ E2E æµ‹è¯•

## é¡¹ç›®ä»·å€¼

è¿™ä¸ªé¡¹ç›®å±•ç°äº†**ç°ä»£åŒ– Web3 å¼€å‘çš„æœ€ä½³å®è·µ**ï¼Œé€šè¿‡ Monorepo æ¶æ„å®ç°äº†**ä»£ç å¤ç”¨å’Œæ¨¡å—åŒ–å¼€å‘**ï¼Œä¸ºæ„å»ºå¤§å‹å»ä¸­å¿ƒåŒ–åº”ç”¨æä¾›äº†**åšå®çš„æŠ€æœ¯åŸºç¡€**ã€‚é¡¹ç›®åœ¨**ç±»å‹å®‰å…¨**ã€**å¼€å‘ä½“éªŒ**å’Œ**å¯ç»´æŠ¤æ€§**æ–¹é¢éƒ½è¾¾åˆ°äº†**ç”Ÿäº§çº§åˆ«**çš„æ ‡å‡†ã€‚

**æ ¸å¿ƒä»·å€¼**:
- ğŸ—ï¸ **å¯æ‰©å±•æ¶æ„**: Monorepo + å¾®æœåŠ¡åŒ–è®¾è®¡
- ğŸ”’ **ç±»å‹å®‰å…¨**: å…¨é“¾è·¯ TypeScript ä¿éšœ
- ğŸš€ **ç°ä»£æŠ€æœ¯æ ˆ**: Next.js + Ethers.js + React 19
- ğŸ› ï¸ **å¼€å‘æ•ˆç‡**: ç»Ÿä¸€å·¥å…·é“¾å’Œè§„èŒƒ
- ğŸ”„ **ä»£ç å¤ç”¨**: è·¨é¡¹ç›®å…±äº«ç»„ä»¶å’Œå·¥å…·
- ğŸ¯ **ä¸“ä¸šçº§**: ç”Ÿäº§ç¯å¢ƒå°±ç»ªçš„ä»£ç è´¨é‡